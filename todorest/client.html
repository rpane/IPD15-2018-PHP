<!DOCTYPE html>

<html>
    <head>
        <title>TODO Web App</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="/styles.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script>
            function refreshTodoList() {
                $.ajax({
                    url: "/api.php/todos",
                    type: "GET",
                    dataType: "json"
                }).done(function (todoList) {
                    var result = "<tr><th>#</th><th>task</th><th>due date</th><th>done</th></tr>\n";
                    for (var i = 0; i < todoList.length; i++) {
                        var todo = todoList[i];
                        result += '<tr>';
                        result += '<td>' + todo.id + '</td>';
                        result += '<td>' + todo.task + '</td>';
                        result += '<td>' + todo.dueDate + '</td>';
                        result += '<td>' + todo.isDone + '</td>';
                    }
                    $("#listTable").html(result);
                });
            }

            $(document).ready(function () {
                $("#viewAddEditPane").hide();
                $("#showAddItem").click(function(){
                    $("#viewAddEditPane").show();
                });
                $("#cancel").click(function(){
                    $("#viewAddEditPane").hide();
                });
                
                $("#saveOrAdd").click(function(){
                    var task = $("input[name=task]").val();
                    var dueDate = $("input[name=dueDate]").val();
                    var isDoneRaw = $("input[name=isDone]").prop('checked');
                    console.log("task: "+ task + ", dueDate: "+dueDate+" , isDoneRaw: "+isDoneRaw);
                    $.ajax({
                        url: "/api.php/todos",
                    type: "GET",
                    dataType: "json"
                    }).done(function(){
                        alert("Added successfully");
                        refreshTodoList();
                    });
                });    
                
                
                $(document).ajaxError(function () {
                    alert("Ajax error occured");
                });
                //alert("its working");
                refreshTodoList();
            });
        </script>
    </head>
    <body>
        <div id="centeredContent">
            <button id="showAddItem">Add todo item</button>
            <div id="listPane">
                <table id="listTable" border="1">

                </table>
            </div>
            <div id="viewAddEditPane">
                Current id: <span id="currentId"></span><br>
                Task: <input type="text" name="task"><br>
                Due date: <input type="date" name="dueDate"><br>
                Is done: <input type="checkbox" name="isDone"><br>
                <button id="saveOrAdd">Save or Add</button>
                <button id="delete">Delete</button>
                <button id="cancel">Cancel</button>
            </div>
        </div>
    </body>
</html>
